/*
 * SPDX-License-Identifier: GPL-2.0-only
 * Copyright (c) 2022 Qualcomm Innovation Center, Inc. All rights reserved.
 */

#ifndef _ECPRI_DMA_REG_DUMP_H_
#define _ECPRI_DMA_REG_DUMP_H_

#include "dmahal_reg.h"
#include "gsihal_reg.h"
#include "ecpri_dma_i.h"
#include "ecpri_hwio.h"
#include "ecpri_hwio_def.h"
#include "ecpri_gsi_hwio.h"
#include "ecpri_gsi_hwio_def.h"

#define ECPRI_DMA_REG_SAVE_GSI_EV_CH_MAX HWIO_GSI_EE_n_EV_CH_k_CNTXT_0_MAXk
#define ECPRI_DMA_REG_SAVE_GSI_CH_MAX HWIO_GSI_EE_n_GSI_CH_k_CNTXT_0_MAXk

#define ECPRI_DMA_MAX_EE ECPRI_DMA_EE_PF + 1
#define ECPRI_DMA_REG_SAVE_TEST_BUS_MAX                    (256)
#define ECPRI_DMA_REG_SAVE_TEST_BUS_MAX_ALL \
			ECPRI_DMA_REG_SAVE_TEST_BUS_MAX + ECPRI_DMA_REG_SAVE_TEST_BUS_MAX
#define ECPRI_DMA_REG_SAVE_FW_VER_ROW                     (66)

#define ECPRI_GSI_OFFSET_WORDS_SCRATCH_FOR_SEQ_LOW         18
#define ECPRI_GSI_OFFSET_WORDS_SCRATCH_FOR_SEQ_HIGH        19
#define ECPRI_DMA_REG_SAVE_BYTES_PER_CHNL_SHRAM            20

#define ECPRI_DMA_REG_SAVE_GSI_NUM_EE                     (7)
#define ECPRI_DMA_GSI_HW_QSB_LOG_MISC_MAX                 (4)

enum gsi_debug_test_bus_selector {
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_ZEROS=0x0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_0=0x1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_1=0x2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_2=0x3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_3=0x4,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_4=0x5,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_DB_ENG=0x9,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_0=0xB,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_1=0xC,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_2=0xD,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_3=0xE,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_4=0xF,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_5=0x10,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_6=0x11,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_7=0x12,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_0=0x13,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_1=0x14,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_2=0x15,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_3=0x16,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_4=0x17,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_5=0x18,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_0=0x1B,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_1=0x1C,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_2=0x1D,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_0=0x1F,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_1=0x20,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_2=0x21,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_3=0x22,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_4=0x23,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_0=0x27,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_1=0x28,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_2=0x29,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_3=0x2A,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_0=0x2B,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_1=0x2C,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_2=0x2D,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_3=0x2E,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_0=0x33,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_1=0x34,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_2=0x35,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_3=0x36,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR=0x3A,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_SDMA_0=0x3C,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_SDMA_1=0x3D,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_1=0x3E,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_2=0x3F,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_5=0x40,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_5=0x41,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_3=0x42,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TLV_0=0x43,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_8=0x44,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_NOTIFY=0x45,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_DB_MSI=0x46,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_9=0x47,
};

#define __ECPRI_DMA_CONCATENATE(A, B) A ## B
#define ECPRI_DMA_CONCATENATE(A, B) __ECPRI_DMA_CONCATENATE(A, B)

/*
 * a macro to generate a number of MAX k allowed in a register
 * who has suffix of _k
 */
#define GEN_MAX_k(reg_name) \
  HWIO_ ## reg_name ## _MAXk

/*
* a macro to generate a number of MAX n allowed in a register
* who has suffix of _n
*/
#define GEN_MAX_n(reg_name) \
  HWIO_ ## reg_name ## _MAXn

/*
* a macro to generate a number of MAX n + 1 allowed in a register
* who has suffix of _n
*/
#define GEN_ARR_SIZE_n(reg_name) \
	GEN_MAX_n(reg_name) + 1

/*
* a macro to generate a number of MAX k + 1 allowed in a register
* who has suffix of _k
*/
#define GEN_ARR_SIZE_k(reg_name) \
	GEN_MAX_k(reg_name) + 1

/*
 * helper macro to wrap struct intended for array as regs array
 * in order to create array with max_k == 1 we need to declare
 * it as arr[max_k + 1] -> arr[2]
 */
#define GEN_REGS_ARRAY(struct_name, reg_name) \
	struct ECPRI_DMA_CONCATENATE(struct_name, _arr) { \
		struct_name arr[GEN_MAX_k(reg_name) + 1]; \
	}

#define GEN_REGS_ARRAY_2D(struct_name, reg_name) \
	struct ECPRI_DMA_CONCATENATE(struct_name, _arr) { \
		struct_name arr[GEN_MAX_n(reg_name) + 1][GEN_MAX_k(reg_name) + 1]; \
	}

static u32 ecpri_dma_reg_save_gsi_test_bus_selector_array[] = {
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_ZEROS,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_4,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_DB_ENG,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_4,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_5,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_6,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_7,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_4,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_EVE_5,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_4,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MOQA_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TMR_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_RD_WR_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_SDMA_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_SDMA_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_1,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_2,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_MCS_5,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IC_5,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_CSR_3,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_TLV_0,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_8,
	HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_IE_NOTIFY,
    HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_DB_MSI,
    HWIO_GSI_DEBUG_TEST_BUS_SELECTOR_REE_9,
};

void ecpri_dma_save_registers(void);

#endif /* _ECPRI_DMA_REG_DUMP_H_ */